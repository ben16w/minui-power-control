#!/bin/sh

print_usage() {
    echo "Usage: $0 start|stop"
    exit 1
}

main() {
    if [ "$#" -lt 1 ] || [ "$#" -gt 1 ]; then
        print_usage
    fi

    if [ ! -f /tmp/powercontrol-rom-path ]; then
        echo "ROM path file not found. Unable to start or stop the tracker for the emulator."
        exit
    fi

    if [ ! -f /usr/bin/gametimectl.elf ]; then
        echo "gametimectl.elf not found. Unable to start or stop the tracker for the emulator."
        exit
    fi

    ACTION="$1"
    ROM_PATH=$(cat /tmp/powercontrol-rom-path)

    if [ ! -f "$ROM_PATH" ]; then
        echo "Invalid ROM path: $ROM_PATH"
        exit 1
    fi

    case "$ACTION" in
        start)
            if [ -n "$ROM_PATH" ]; then
                gametimectl.elf start "$ROM_PATH"
            fi
            ;;
        stop)
            if [ -n "$ROM_PATH" ]; then
                gametimectl.elf stop "$ROM_PATH"
            fi
            ;;
        *)
            print_usage
            ;;
    esac
}

main "$@"